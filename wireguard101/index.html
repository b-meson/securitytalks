<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>WireGuard, a fast, modern and secure VPN framework</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="tutorial.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress-help"></div><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="wireguard-a-fast-modern-and-secure-vpn-tunnel">WireGuard: a Fast, Modern and Secure VPN tunnel</h1><p>Freddy Martinez</p><p>Chicago Linux Users Group</p><p>May 2nd, 2020</p></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="overview">Overview</h1><p>I recently completed a review of WireGuard, a new VPN framework built to replace
many of the pitfalls or both IPSec and openVPN.</p><p>My review included a review of the white paper, various deployments on different platforms and a high-level analysis of the cryptographic design.</p><figure><img src="images/wireguardlogo.png"></img></figure><div class="notes"><p>I am not an expert on VPNs or IP routing, so this is not going to be a super-technical talk.</p></div></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="wireguard-history">WireGuard History</h1><p>In development for about the last three years but has been pulled into official Linux kernel as of December of 2019. (yay!)</p><p>For years, you would have to side-load a linux kernel module to get WireGuard to work; now supported in the Linux 5.6 kernel.</p><p>It should be supported natively for everyone who uses the newest Fedora 32.</p></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="features">Features</h1><ul><li>Simple: Few lines of code, few configuration options.</li><li>Fast: Seriously fast. Like very fast.</li><li>Cryptographic secure.</li></ul></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="simple">Simple</h1><p>WireGuard was written in less than 4,000 lines of code (outside of their use of cryptographic primitives).</p><p>Compares to 600,000 total lines of code for OpenVPN + OpenSSL. [0]</p><p>Very few runtime configurations. No picking numerous cipher suites at runtime and no TLS stack like in OpenSSL.</p><div class="notes"><p>These primitives are now moved to the Linux kernel and should not be maintained by the library.</p></div></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="fast">Fast</h1><p>One round-trip to re-establish a connection means waking up your VPN is a breeze.</p><p>Mobile friendly! (iOS/Android apps available)</p><p>Kernel-level, so no costly operations from user-space.</p><p>Other improvements like generic segmentation offload (GSO) to speed things up.</p></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="id1">Fast</h1><p>Cryptography uses a lot of your familiar primitives which can be hardware accelerated!</p><figure><img src="images/hardwareacceleration.png"></img></figure></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><h1 id="cryptography-continued">Cryptography Continued</h1><p>WireGuard extends a framework called &#x201C;Noise Protocol&#x201D;, using &#x201C;Noise_IK_25519_ChaChaPoly_BLAKE2&#x201D;.</p><ul><li>Elliptic curve, Curve25519, for generating Diffie-Hellman keys.</li><li>ChaCha20Poly1305, a highly regarded authenticated stream cipher, for encryption and decryption.</li><li>Finally it &#x201C;hashes,&#x201D; to validate data has not been tampered with, using the BLAKE2s hash function.</li></ul><div class="notes"><p>Noise is a framework for crypto protocols based on Diffie-Hellman key agreement. The Noise Protocol is used by WhatsApp to implement its communication layering. Notice, there are no options to change setting up the channels.</p></div></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="setting-up-a-connection">Setting Up A Connection</h1><p>Like all Linux network interfaces, WireGuard integrates into the network namespace infrastructure. (Container ready)</p><pre class="highlight code bash"><span class="o">[</span>Interface<span class="o">]</span>
<span class="nv">PrivateKey</span> <span class="o">=</span> &lt;Something Here&gt;
<span class="nv">Address</span> <span class="o">=</span> <span class="m">10</span>.64.245.113/32, fc00:bbbb:bbbb:bb01::1:f570/128
<span class="nv">DNS</span> <span class="o">=</span> <span class="m">193</span>.138.218.74

<span class="o">[</span>Peer<span class="o">]</span>
<span class="nv">PublicKey</span> <span class="o">=</span> <span class="nv">XTdlx3YmLb1vg1NsruXYmfzP6FZKmZR90Vr3u9kJ7S0</span><span class="o">=</span>
<span class="nv">AllowedIPs</span> <span class="o">=</span> <span class="m">0</span>.0.0.0/0, ::/0
<span class="nv">Endpoint</span> <span class="o">=</span> IP:UDP Port</pre></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><h1 id="locally">Locally</h1><p>Notice a few things, a private key for the local interface creating.</p><pre class="highlight code bash"><span class="nv">PrivateKey</span> <span class="o">=</span> &lt;Something Here&gt;
<span class="nv">PublicKey</span> <span class="o">=</span> &lt;Something Here&gt;
<span class="nv">Address</span> <span class="o">=</span> <span class="m">10</span>.64.245.113/32, fc00:bbbb:bbbb:bb01::1:f570/128
<span class="nv">DNS</span> <span class="o">=</span> <span class="m">193</span>.138.218.74</pre></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="peering">Peering</h1><p>There are no "servers" or "clients" in the traditional sense but there are "peers".
In this case, the Public Key and IP is a computer I have in the cloud.</p><pre class="highlight code bash"><span class="o">[</span>Peer<span class="o">]</span>
<span class="nv">PublicKey</span> <span class="o">=</span> <span class="nv">XTdlx3YmLb1vg1NsruXYmfzP6FZKmZR90Vr3u9kJ7S0</span><span class="o">=</span>
<span class="nv">PrivateKey</span> <span class="o">=</span> &lt;Something Here&gt;
<span class="nv">AllowedIPs</span> <span class="o">=</span> <span class="m">0</span>.0.0.0/0, ::/0
<span class="nv">Endpoint</span> <span class="o">=</span> &lt;Cloud IP&gt;:UDP Port</pre></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="clients">Clients</h1><figure><img src="images/wireguard_osx.png"></img></figure></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="key-exchange">Key Exchange</h1><ul><li>Public and private keys generated locally (by default), very similar to OpenSSH keys.</li><li>Up to you to figure out how to deploy keys (LDAP or similar solution).</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="testing-wireguard-from-source">Testing WireGuard From Source</h1><p>It was painful. I don't recommend building from source and trying to deploy it in the cloud by yourself.</p><p><em>Your milage may vary</em>. There are two better options:</p><ul><li>Pay for a VPN service that already supports WireGuard.</li><li>Better and more secure: Deploy using <a href="https://github.com/trailofbits/algo/">Algo</a>.</li></ul><div class="notes"><p>Again, I am not an expert at setting up VPNs or configuring networks.</p></div></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="id2">Algo</h1><p>Setup a VPN in the Cloud with few configurations.</p><p>You can establish a server using any cloud provider you want: AWS, Digital Ocean, Rackspace etc.</p><p>You will have to have AIM keys or similar already provisioned.</p></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="demo-and-questions">Demo and Questions</h1><figure><img src="images/algosuccess.png"></img></figure></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="other-resources">Other Resources</h1><ul><li>Cryptanalysis of WireGuard <a href="https://www.wireguard.com/papers/lipp-computational-2018.pdf">https://www.wireguard.com/papers/lipp-computational-2018.pdf</a></li><li>WireGuard white paper <a href="https://www.wireguard.com/papers/wireguard.pdf">https://www.wireguard.com/papers/wireguard.pdf</a></li><li>WireGuard man page <a href="https://git.zx2c4.com/WireGuard/about/src/tools/man/wg.8">https://git.zx2c4.com/WireGuard/about/src/tools/man/wg.8</a></li><li>WireGuard on a router <a href="https://openwrt.org/docs/guide-user/services/vpn/wireguard/start">https://openwrt.org/docs/guide-user/services/vpn/wireguard/start</a></li></ul></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="links">Links</h1><ul><li><a href="https://arstechnica.com/gadgets/2018/08/wireguard-vpn-review-fast-connections-amaze-but-windows-support-needs-to-happen/">https://arstechnica.com/gadgets/2018/08/wireguard-vpn-review-fast-connections-amaze-but-windows-support-needs-to-happen/</a></li><li><a href="https://en.wikipedia.org/wiki/File:IBM4758_outside1.JPG">https://en.wikipedia.org/wiki/File:IBM4758_outside1.JPG</a></li><li><a href="https://github.com/trailofbits/algo">https://github.com/trailofbits/algo</a></li><li><a href="https://www.dropbox.com/s/qcvk7dgvzc1j6lp/Copy%20of%20WireGuard%20Report.pdf?dl=0">https://www.dropbox.com/s/qcvk7dgvzc1j6lp/Copy%20of%20WireGuard%20Report.pdf?dl=0</a></li></ul></div></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/gotoSlide.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>